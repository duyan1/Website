@model EWShop.Models.SellOutReport
@{
    ViewBag.Title = "Thống kê doanh số bán hàng";
    Layout = "~/Views/Layout/_LayoutDashboard.cshtml";
    IEnumerable<EWShop.Models.DataReturn> listMonths = (IEnumerable<EWShop.Models.DataReturn>)ViewData["MONTH"];
}
@section Styles {
    <style>
        .panel-heading {
            padding: 5px 15px;
        }

        .panel-body {
            padding: 5px 20px;
        }

        .box {
            position: relative;
            border-radius: 3px;
            background: #ffffff;
            border-top: 3px solid #d2d6de;
            margin-bottom: 20px;
            width: 100%;
            box-shadow: 0 1px 1px rgba(0,0,0,0.1);
        }

            .box.box-info {
                border-top-color: #00c0ef;
            }

            .box.box-primary {
                border-top-color: #3c8dbc;
            }

        .box-header {
            color: #444;
            display: block;
            padding: 10px;
            position: relative;
        }

            .box-header.with-border {
                border-bottom: 1px solid #f4f4f4;
            }

            .box-header > .fa, .box-header > .glyphicon, .box-header > .ion, .box-header .box-title {
                display: inline-block;
                font-size: 18px;
                margin: 0;
                line-height: 1;
                font-family: 'Source Sans Pro',sans-serif;
                color: inherit;
            }

        .box-body {
            border-top-left-radius: 0;
            border-top-right-radius: 0;
            border-bottom-right-radius: 3px;
            border-bottom-left-radius: 3px;
            padding: 0 10px;
        }

        .box-footer {
            border-top-left-radius: 0;
            border-top-right-radius: 0;
            border-bottom-right-radius: 3px;
            border-bottom-left-radius: 3px;
            border-top: 1px solid #f4f4f4;
            padding: 10px;
            background-color: #fff;
        }

        .products-list {
            list-style: none;
            margin: 0;
            padding: 0;
        }

        .product-list-in-box > .item {
            -webkit-box-shadow: none;
            box-shadow: none;
            border-radius: 0;
            border-bottom: 1px solid #f4f4f4;
            padding: 10px 0;
            background: #fff;
        }

        .products-list > .item:before, .products-list > .item:after {
            content: " ";
            display: table;
        }

        .products-list > .item:after {
            clear: both;
        }

        .products-list .product-img {
            float: left;
        }

            .products-list .product-img img {
                width: 50px;
                height: 50px;
            }

        .products-list .product-info {
            margin-left: 60px;
        }

        .products-list .product-title {
            font-weight: 600;
            color: #3c8dbc;
        }

        .products-list .product-description {
            display: block;
            color: #999;
            overflow: hidden;
            white-space: nowrap;
            text-overflow: ellipsis;
        }

        .info-box {
            display: block;
            min-height: 90px;
            background: #fff;
            width: 100%;
            box-shadow: 0 1px 1px rgba(0,0,0,0.1);
            border-radius: 2px;
            margin-bottom: 15px;
        }

        .bg-red, .bg-yellow, .bg-aqua, .bg-blue, .bg-light-blue, .bg-green, .bg-navy, .bg-teal, .bg-olive, .bg-lime, .bg-orange, .bg-fuchsia, .bg-purple, .bg-maroon, .bg-black, .bg-red-active, .bg-yellow-active, .bg-aqua-active, .bg-blue-active, .bg-light-blue-active, .bg-green-active, .bg-navy-active, .bg-teal-active, .bg-olive-active, .bg-lime-active, .bg-orange-active, .bg-fuchsia-active, .bg-purple-active, .bg-maroon-active, .bg-black-active, .callout.callout-danger, .callout.callout-warning, .callout.callout-info, .callout.callout-success, .alert-success, .alert-danger, .alert-error, .alert-warning, .alert-info, .label-danger, .label-info, .label-warning, .label-primary, .label-success, .modal-primary .modal-body, .modal-primary .modal-header, .modal-primary .modal-footer, .modal-warning .modal-body, .modal-warning .modal-header, .modal-warning .modal-footer, .modal-info .modal-body, .modal-info .modal-header, .modal-info .modal-footer, .modal-success .modal-body, .modal-success .modal-header, .modal-success .modal-footer, .modal-danger .modal-body, .modal-danger .modal-header, .modal-danger .modal-footer {
            color: #fff !important;
        }

        .bg-green {
            background-color: #00a65a !important;
        }

        .bg-aqua {
            background-color: #00c0ef !important;
        }

        .info-box-icon {
            border-top-left-radius: 2px;
            border-top-right-radius: 0;
            border-bottom-right-radius: 0;
            border-bottom-left-radius: 2px;
            display: block;
            float: left;
            height: 90px;
            width: 90px;
            text-align: center;
            font-size: 45px;
            line-height: 90px;
            background: rgba(0,0,0,0.2);
        }

        .info-box-content {
            padding: 3px 10px;
            margin-left: 90px;
        }

        .info-box-text {
            text-transform: uppercase;
        }

        .progress-description, .info-box-text {
            display: block;
            font-size: 14px;
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis;
        }

        .info-box-number {
            display: block;
            font-weight: bold;
            font-size: 18px;
        }

        .info-box .progress, .info-box .progress .progress-bar {
            border-radius: 0;
        }

        .info-box .progress {
            background: rgba(0,0,0,0.2);
            margin: 5px -10px 5px -10px;
            height: 2px;
        }

            .info-box .progress .progress-bar {
                background: #fff;
            }

        .progress-description {
            margin: 0;
        }

        .info-box .progress, .info-box .progress .progress-bar {
            border-radius: 0;
        }

        .progress {
            margin-bottom: 5px !important;
        }

        .description-text {
            font-size: 16px;
            font-weight: 600;
            width: 100%;
            float: left;
            text-align: center;
        }

        .progress-bar-green, .progress-bar-success {
            background-color: #00a65a;
        }

        .progress-bar-aqua, .progress-bar-info {
            background-color: #00c0ef;
        }

        .progress-bar-yellow, .progress-bar-warning {
            background-color: #f39c12;
        }

        .progress-bar-red, .progress-bar-danger {
            background-color: #dd4b39;
        }
    </style>
}
<div class="row">
    <div class="col-md-12">
        <div class="panel panel-primary">
            <div class="panel-heading custom-header-panel">
                <h5 class="panel-title roboto">
                    DOANH SỐ BÁN HÀNG THEO THÁNG
                </h5>
            </div>
            <div class="panel-body">
                <div class="row">
                    <div class="col-md-6">
                        <div class="box box-info">
                            <div class="box-header with-border">
                                <h3 class="box-title">Tổng doanh số bán hàng theo tháng</h3>
                                <div class="box-tools pull-right" style="margin-top: -3px;">
                                    @using (Html.BeginForm("Index", "Report", FormMethod.Post, new { @class = "form-filter" }))
                                    {
                                        <select class="form-control form-select" style="height: 30px; padding: 4px 8px;" name="month">
                                            @foreach (var item in listMonths)
                                            {
                                                <option value="@item.value" @if (item.value == Model.month)
                                                { @("selected='selected'") }>@item.text</option>
                                                }
                                        </select>
                                    }
                                </div>
                            </div>
                            <!-- /.box-header -->
                            <div class="box-body" style="padding-top: 19px;">
                                <div class="info-box bg-green">
                                    <span class="info-box-icon"><i class="fa fa fa-shopping-cart"></i></span>
                                    <div class="info-box-content">
                                        <span class="info-box-text">Số lượng sản phẩm bán ra</span>
                                        <span class="info-box-number">@Model.qtySellOut</span>
                                        <div class="progress">
                                            <div class="progress-bar" style="width: 80%"></div>
                                        </div>
                                        <span class="progress-description">
                                            Tháng @Model.month/@Model.year
                                        </span>
                                    </div>
                                    <!-- /.info-box-content -->
                                </div>
                                <div class="info-box bg-aqua">
                                    <span class="info-box-icon"><i class="fa fa-dollar"></i></span>
                                    <div class="info-box-content">
                                        <span class="info-box-text">Doanh thu</span>
                                        <span class="info-box-number">@Model.revenue</span>
                                        <div class="progress">
                                            <div class="progress-bar" style="width: 80%"></div>
                                        </div>
                                        <span class="progress-description">
                                            Tháng @Model.month/@Model.year
                                        </span>
                                    </div>
                                    <!-- /.info-box-content -->
                                </div>
                            </div>
                            <!-- /.box-body -->
                            <div class="box-footer text-center">
                                <a href="@Url.Action("ViewDetail","Report")" class="btn btn-sm btn-default btn-flat">Xem chi tiết</a>
                            </div>
                            <!-- /.box-footer -->
                        </div>
                    </div>
                    <div class="col-md-6">
                        <div class="box box-primary">
                            <div class="box-header with-border">
                                <h3 class="box-title">Doanh số bán chi tiết theo sản phẩm</h3>
                            </div>
                            <!-- /.box-header -->
                            <div class="box-body">
                                <ul class="products-list product-list-in-box">
                                    @if (Model.detail != null && Model.detail.Count > 0)
                                    {
                                        foreach (var item in Model.detail)
                                        {
                                            <li class="item">
                                                <div class="product-img">
                                                    <img src="@item.avatar" alt="@item.plantName" />
                                                </div>
                                                <div class="product-info">
                                                    <a href="javascript:void(0)" class="product-title" data-id="@item.plantId">
                                                        Doanh số bán : @item.qtySellOut
                                                    </a>
                                                    <span class="product-description">
                                                        Doanh thu : @item.revenue
                                                    </span>
                                                </div>
                                            </li>
                                        }
                                    }
                                    else
                                    {
                                        <li class="item text-center">
                                            KHÔNG CÓ DỮ LIỆU
                                        </li>
                                    }
                                </ul>
                            </div>
                            <!-- /.box-body -->
                        </div>
                    </div>
                </div>
                <div class="row">
                    <div class="col-md-12">
                        <div class="box">
                            <div class="box-header with-border">
                                <h3 class="box-title">Biểu đồ doanh số bán hàng theo 4 tháng gần nhất</h3>
                            </div>
                            <!-- /.box-header -->
                            <div class="box-body">
                                <div class="row">
                                    <div class="col-md-12">
                                        <p class="text-center">
                                            <strong>@DateTime.Now.AddMonths(-4).ToString("MM/yyyy") - @DateTime.Now.ToString("MM/yyyy")</strong>
                                        </p>
                                        <div class="chart">
                                            <canvas id="barChart" style="height: 300px; width: 100%;" width="743" height="400"></canvas>
                                        </div>
                                        <!-- /.chart-responsive -->
                                    </div>
                                    <!-- /.col -->
                                </div>
                                <!-- /.row -->
                            </div>
                            <!-- ./box-body -->
                            <div class="box-footer">
                                <div class="row">
                                    <div class="col-sm-3 col-xs-6">
                                        <div class="description-block text-sm-center">
                                            <div class="progress">
                                                <div class="progress-bar progress-bar-green" role="progressbar" aria-valuenow="100" aria-valuemin="0" aria-valuemax="100" style="width: 100%"></div>
                                            </div>
                                            <span class="description-text">Máy giặt</span>
                                        </div>
                                        <!-- /.description-block -->
                                    </div>
                                    <!-- /.col -->
                                    <div class="col-sm-3 col-xs-6">
                                        <div class="description-block border-right">
                                            <div class="progress">
                                                <div class="progress-bar progress-bar-aqua" role="progressbar" aria-valuenow="100" aria-valuemin="0" aria-valuemax="100" style="width: 100%"></div>
                                            </div>
                                            <span class="description-text">Tủ lạnh</span>
                                        </div>
                                        <!-- /.description-block -->
                                    </div>
                                    <!-- /.col -->
                                    <div class="col-sm-3 col-xs-6">
                                        <div class="description-block border-right">
                                            <div class="progress">
                                                <div class="progress-bar progress-bar-yellow" role="progressbar" aria-valuenow="100" aria-valuemin="0" aria-valuemax="100" style="width: 100%"></div>
                                            </div>
                                            <span class="description-text">Máy lạnh</span>
                                        </div>
                                        <!-- /.description-block -->
                                    </div>
                                    <!-- /.col -->
                                    <div class="col-sm-3 col-xs-6">
                                        <div class="description-block">
                                            <div class="progress">
                                                <div class="progress-bar progress-bar-red" role="progressbar" aria-valuenow="100" aria-valuemin="0" aria-valuemax="100" style="width: 100%"></div>
                                            </div>
                                            <span class="description-text">Hàng gia dụng</span>
                                        </div>
                                        <!-- /.description-block -->
                                    </div>
                                </div>
                                <!-- /.row -->
                            </div>
                            <!-- /.box-footer -->
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

@section Scripts {
    <script src="@Url.Content("~/Libraries/dist/js/Chart.js")"></script>
    <script>

        $(document).ready(function () {
            var d = new Date();
            var n = d.getMonth();

            var arrayMonth = ['Tháng ' + (n - 2), 'Tháng ' + (n - 1), 'Tháng ' + (n), 'Tháng ' + (n + 1)]
            var areaChartData;
            
            $.ajax({
                type: "GET",
                url: '@Url.Action("getData4Months", "Report")',
                success: function (data) {
                    areaChartData = {
                        labels: arrayMonth,
                        datasets: data
                    }
                }, error: function (e) {
                    alert(e);
                }, complete: function () {
                    //-------------
                    //- BAR CHART -
                    //-------------
                    var barChartCanvas = $('#barChart').get(0).getContext('2d')
                    var barChart = new Chart(barChartCanvas)
                    var barChartData = areaChartData
                    var barChartOptions = {
                        //Boolean - Whether the scale should start at zero, or an order of magnitude down from the lowest value
                        scaleBeginAtZero: true,
                        //Boolean - Whether grid lines are shown across the chart
                        scaleShowGridLines: true,
                        //String - Colour of the grid lines
                        scaleGridLineColor: 'rgba(0,0,0,.05)',
                        //Number - Width of the grid lines
                        scaleGridLineWidth: 1,
                        //Boolean - Whether to show horizontal lines (except X axis)
                        scaleShowHorizontalLines: true,
                        //Boolean - Whether to show vertical lines (except Y axis)
                        scaleShowVerticalLines: true,
                        //Boolean - If there is a stroke on each bar
                        barShowStroke: true,
                        //Number - Pixel width of the bar stroke
                        barStrokeWidth: 2,
                        //Number - Spacing between each of the X value sets
                        barValueSpacing: 5,
                        //Number - Spacing between data sets within X values
                        barDatasetSpacing: 1,
                        //String - A legend template
                        legendTemplate: '<ul class="<%=name.toLowerCase()%>-legend"><% for (var i=0; i<datasets.length; i++){%><li><span style="background-color:<%=datasets[i].fillColor%>"></span><%if(datasets[i].label){%><%=datasets[i].label%><%}%></li><%}%></ul>',
                        //Boolean - whether to make the chart responsive
                        responsive: true,
                        maintainAspectRatio: true
                    }

                    barChartOptions.datasetFill = false
                    barChart.Bar(barChartData, barChartOptions);
                }
            });
            $('.form-select').on('change', function () {
                $('.form-filter').submit();
            });
        });
    </script>
}
