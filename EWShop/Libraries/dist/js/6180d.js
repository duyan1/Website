var App={owlCarousel:function(){var archiveSlider=jQuery('.archive-slider');if(archiveSlider){archiveSlider.owlCarousel({items:1,autoplay:true,dots:true});}
var productMore=jQuery('.products-more .owl-carousel');if(productMore.length){productMore.owlCarousel({autoplay:true,dots:false,nav:true,navText:['<span class="fa fa-chevron-left"></span>','<span class="fa fa-chevron-right"></span>'],responsive:{0:{items:1},600:{items:2},1024:{items:3},1366:{items:4}}});}
var productGalerry=jQuery('#productGalllery');if(productGalerry.length){productGalerry.owlCarousel({autoplay:true,nav:true,navText:['<span class="fa fa-angle-up"></span>','<span class="fa fa-angle-down"></span>'],items:1,dots:true,navContainer:".gallery-nav",dotsContainer:".gallery-dots"});var dotcount=1;jQuery('.owl-dot').each(function(){jQuery(this).addClass('dotnumber'+dotcount);jQuery(this).attr('data-info',dotcount);dotcount=dotcount+1;});var slidecount=1;jQuery('.owl-item').not('.cloned').each(function(){jQuery(this).addClass('slidenumber'+slidecount);slidecount=slidecount+1;});jQuery('.owl-dot').each(function(){var grab=jQuery(this).data('info');var slidegrab=jQuery('.slidenumber'+grab+' img').attr('src');jQuery(this).css("background-image","url("+slidegrab+")");});}},navbarMenu:function(){jQuery('.search-mobile').on('click',function(){jQuery(this).parents('li').find('#searchform').slideToggle();});var old_img='';jQuery('.mega-wrap .sub-menu a').mouseover(function(){var img_src=jQuery(this).data('src');var img_area=jQuery(this).parents('.mega-wrap').find('.mega-image img');old_img=img_area.attr('src');img_area.attr('src',img_src);});jQuery('.mega-wrap .sub-menu a').mouseout(function(){var img_area=jQuery(this).parents('.mega-wrap').find('.mega-image img');img_area.attr('src',old_img);});},filterProducts:function(){jQuery('.filter-area span').on('click',function(){var _this=jQuery(this),filterForm=jQuery(this).parents('.filter-area').find('.filter-wrap');if(_this.hasClass('active')){filterForm.slideUp();_this.removeClass('active');}else{_this.addClass('active');filterForm.slideDown();}});jQuery('.order-area .sub-order li').on('click',function(e){var _this=jQuery(this),text=_this.text(),order_val=_this.data('order');jQuery('.input-order').val(order_val);jQuery('.form-filter').submit();});jQuery('.order-area').on('click','span',function(e){e.preventDefault();var _this=jQuery(this).parents('.order-area'),orderList=jQuery(this).parents('.order-area').find('.sub-order');if(_this.hasClass('active')){orderList.slideUp();_this.removeClass('active');}else{_this.addClass('active');orderList.slideDown();}});jQuery('.btn-reset').on('click',function(){jQuery('.form-filter').find('input[type="checkbox"]').prop('checked',false);jQuery('.form-filter').find('input[type="checkbox"]').removeAttr('checked');jQuery('.form-filter').find('input[type="radio"]').prop('checked',false);jQuery('.form-filter').find('input[type="radio"]').removeAttr('checked');jQuery('.form-filter').find('.filter-wrap').slideUp();jQuery('.filter-area').find('span').removeClass('active');});if(jQuery('.single-product').length){var divElement=jQuery('.single-product .product-header'),divHeight=divElement.offset().top;var top=jQuery(window).scrollTop();fixedProductHeader(top);jQuery(window).scroll(function(){var top=jQuery(this).scrollTop();fixedProductHeader(top);});function fixedProductHeader(top){if(top>=divHeight){divElement.addClass('fixed');}else{divElement.removeClass('fixed');}}}},popupAction:function(){jQuery('.popup-close, .popup-overlay').on('click',function(){jQuery('.popup').fadeOut();});},controlButton:function(){var short_desc=jQuery('.single-product .prod-short');if(short_desc.length){var shortHeight=short_desc.outerHeight();if(shortHeight>205){short_desc.parents('.prod-text').addClass('active');}else{jQuery('.single-product .prod-text .viewmore').hide();}}
jQuery('.prod-text .viewmore').on('click',function(){var parent=jQuery(this).parents('.prod-text'),_this=jQuery(this);if(parent.hasClass('active')){_this.find('span').text('Rút gọn');}else{_this.find('span').text('Xem thêm');}
parent.toggleClass('active');});jQuery('.backtop').on('click',function(){jQuery('html,body').animate({scrollTop:0},800);});var top=jQuery(window).scrollTop();hideBackTop(top);jQuery(window).on('scroll',function(){var top=jQuery(this).scrollTop();hideBackTop(top);});function hideBackTop(top){if(top<10){jQuery('.backtop').fadeOut();}else{jQuery('.backtop').fadeIn();}}
jQuery('.ctrl-tech').on('click',function(){var tech=jQuery('.product-tech').offset().top;jQuery('html,body').animate({scrollTop:tech-50},800);});if(jQuery('.product-tech').length){jQuery(window).on('scroll',function(){var hT=jQuery('.product-tech').offset().top,hH=jQuery('.product-tech').outerHeight(),wS=jQuery(this).scrollTop();if(wS>(hT-hH+500)){jQuery('.ctrl-tech').fadeOut();}else{jQuery('.ctrl-tech').fadeIn();}});}
jQuery('.upload-area').on('click',function(e){e.preventDefault();jQuery(this).parents('.upload-wrap').find('input[type="file"]').click();});jQuery('input[type="file"]').change(function(e){var fileName=e.target.files[0].name;jQuery(this).parents('.upload-wrap').find('.value-area').text(fileName);});jQuery('.filter-area .button-area').on('click','input',function(){jQuery(this).parents('.filter-wrap').slideUp('slow');});jQuery('.product-tech .tech-header').on('click',function(){jQuery(this).parents('.product-tech').toggleClass('active');});jQuery('.question-list').on('click','a',function(){jQuery('.question-list li').removeClass('active');jQuery(this).parents('li').addClass('active');});jQuery('.partners-menu').mouseover(function(){jQuery(this).parents('.mega-full').find('.sub-menu-partners li:last-child').hide();});jQuery('.partners-menu').mouseout(function(){jQuery(this).parents('.mega-full').find('.sub-menu-partners li:last-child').show();});jQuery('.order-post').on('change',function(){jQuery(this).parents('form').submit();});jQuery('.footer').on('click','.widget-title',function(){jQuery('.footer .widget').removeClass('active');jQuery(this).parents('.widget').toggleClass('active');});},buyWhere:function(){jQuery('.buy-where').on('click',function(){var primary=jQuery(this).data('primary');jQuery('.loading').fadeIn();jQuery.ajax({type:"POST",url:aquavn.ajax_url,data:{primary:primary,action:'get_list_market'},success:function(response){if(response){jQuery('.popup-market .popup-body').html(response);jQuery('.popup-market').fadeIn();}else{alert('Dữ liệu đang được cập nhật !!!');}},complete:function(){jQuery('.loading').fadeOut();}});});jQuery('.popup-close, .popup-overlay').on('click',function(){jQuery('.popup').fadeOut();jQuery('.popup-market .popup-body').html('');});},filterMarkets:function(){var status=1,offset=jQuery('.markets-info').data('limit');jQuery('.markets-list').on('scroll',function(){var parent=jQuery('.markets-info'),limit=offset;var formFilter=jQuery('.market-filter').serialize();var _this=jQuery(this),top=_this.scrollTop(),height=_this.height();var results=_this.find('ul');if((top+height==results.height())&&status==1){status=2;parent.find('.ele-loader').fadeIn();jQuery.ajax({type:"POST",url:aquavn.ajax_url,data:{limit:limit,offset:offset,form:formFilter,action:'loadmore_markets'},success:function(response){if(response){jQuery('.markets-list ul').append(response);offset=offset+limit;}},complete:function(){status=1;jQuery('.ele-loader').fadeOut();}});}});jQuery('.city').on('change',function(){var val=jQuery(this).find('option:selected').val();jQuery('.market-filter').find('.ele-loader').fadeIn();jQuery.ajax({type:"POST",url:aquavn.ajax_url,data:{val:val,action:'loadmore_districts'},success:function(response){if(response){jQuery('select.district').html(response);}else{var _default='<option value="">Quận/Huyện</option>';jQuery('select.district').html(_default);}},complete:function(){jQuery('.market-filter').find('.ele-loader').fadeOut();}});});jQuery('.market-filter').on('submit',function(e){e.preventDefault();var _this=jQuery(this);_this.find('.ele-loader').fadeIn();jQuery.ajax({type:"POST",url:aquavn.ajax_url,data:_this.serialize(),success:function(response){var json=jQuery.parseJSON(response);if(json.status==200){jQuery('.markets-list ul').html(json.html);var newLatLng=new google.maps.LatLng(json.position[0],json.position[1]);var infoContent=json.info;var btn=btn_html(json.address);marker.setPosition(newLatLng);map.setCenter({lat:parseFloat(json.position[0]),lng:parseFloat(json.position[1])});infowindow.setContent(infoContent+btn);infowindow.open(map,marker);}},complete:function(){_this.find('.ele-loader').fadeOut();}});});},loadmoreProducts:function(){var conflict=1,prod_loadmore=jQuery('.product-list .loadmore');jQuery(window).on('scroll',function(){if(prod_loadmore.length){var btnLoad=prod_loadmore.offset().top,scrollTop=jQuery(this).scrollTop();if(scrollTop>=(btnLoad-400)&&conflict==1&&aquavn.current_page<=aquavn.max_page){conflict=0;var data={'action':'loadmore_products','query':aquavn.products,'page':aquavn.current_page};jQuery('.loading').fadeIn();jQuery.ajax({url:aquavn.ajax_url,data:data,type:'POST',success:function(data){if(data){jQuery('.product-list .row').append(data);}
aquavn.current_page++;if(aquavn.current_page==aquavn.max_page){prod_loadmore.remove();}},complete:function(){conflict=1;jQuery('.loading').fadeOut();}});}}});},compareProduct:function(){var status=1,prod_array=[];jQuery('.compare-area').on('click','.close',function(){var removeItem=jQuery(this).data('item');jQuery(this).parents('li').remove();status=status-1;if(status==1){jQuery('.compare-area').hide();}else if(status==2){jQuery('.compare-area .btn-compare').addClass('disabled');}
if(prod_array.length>0){prod_array=jQuery.grep(prod_array,function(value){return value!=removeItem;});}
var productItem=jQuery('.product-list').find("[data-primary='"+removeItem+"']").parents('.product-item');productItem.find('.compare-button').removeAttr('checked');productItem.find('.compare-button').prop('checked',false);});jQuery('.product-list').on('change','.compare-button',function(){var _this=jQuery(this);var html=_this.parents('.product-item').html(),product_ID=_this.val();html='<li class="col-md-4 col-sm-4" data-pos="'+product_ID+'"><span class="close" data-item="'+product_ID+'">&times;</span>'+html+'</li>';if(_this.is(':checked')){if(jQuery.inArray(product_ID,prod_array)==-1){if(status<4){prod_array.push(product_ID);jQuery('.compare-area .lst-compare').append(html);}
if(status==1){jQuery('.compare-area').fadeIn();}else if(status==2){jQuery('.compare-area .btn-compare').removeClass('disabled');}else if(status>3){alert('Bạn có thể so sánh tối đa là 3 sản phẩm !!!');_this.removeAttr('checked');_this.prop('checked',false);}
if(status<4){status++;}}}else{jQuery(".compare-area ul").find("[data-pos='"+product_ID+"']").remove();if(status>1){status--;}
if(status==1){jQuery('.compare-area').hide();}
if(prod_array.length>0){prod_array=jQuery.grep(prod_array,function(value){return value!=product_ID;});}}});jQuery('.compare-area .btn-compare').on('click',function(e){e.preventDefault();var alias=jQuery('.product-list').data('alias');if(!jQuery(this).hasClass('disabled')){jQuery('.loading').fadeIn();jQuery.ajax({url:aquavn.ajax_url,type:"POST",data:{prod:prod_array,alias:alias,action:"compare_product"},success:function(response){jQuery('.modal-compare .compare-body').html(response);jQuery('.modal-compare').fadeIn();},error:function(res){console.log(res);},complete:function(){jQuery('.loading').fadeOut();}});}});jQuery('.modal-compare .close').on('click',function(){jQuery('.modal-compare').fadeOut();jQuery('.modal-compare .compare-modal').html('');jQuery('.compare-area .lst-compare').html('');jQuery('.compare-area').hide();jQuery('.product-list .compare-button').removeAttr('checked');jQuery('.product-list .compare-button').prop('checked',false);status=1;prod_array=[];});jQuery('.btn-compare.disabled').on('click',function(){return false;});},questionAction:function(){var offset=jQuery('.question-area').data('limit'),max='',cnt=1;var limitPerPage=jQuery('.question-area').data('limit'),attr='';jQuery('.loadmore-question a').on('click',function(){if(max==''){max=jQuery('.question-list').data('max');}
if(attr==''){attr=jQuery(this).data('term');}
var data={term:attr,offset:offset,limit:limitPerPage,action:'load_question_list'};if(cnt<max){jQuery('.loading').fadeIn();jQuery.ajax({type:"POST",url:aquavn.ajax_url,data:data,success:function(response){if(response==1){jQuery('.loadmore-question').hide();}else{jQuery('.question-list ul').append(response);offset+=limitPerPage;}
cnt++;},complete:function(){jQuery('.loading').fadeOut();}});}else{jQuery('.loadmore-question').hide();}});jQuery('.question-filter ul li').on('click',function(){jQuery('.question-filter ul li').removeClass('active');jQuery(this).addClass('active');var primary=jQuery(this).data('primary');var data={limit:limitPerPage,primary:primary,action:'load_question_by_category'};jQuery('.loading').fadeIn();jQuery.ajax({type:"POST",url:aquavn.ajax_url,data:data,success:function(response){var json=jQuery.parseJSON(response);if(json==1){alert('Data is empty');}else{if(json.max_pages>1){jQuery('.loadmore-question').fadeIn();jQuery('.loadmore-question a').attr('data-term',primary);attr=primary;max=json.max_pages;offset=limitPerPage;cnt=1;}else{jQuery('.loadmore-question').fadeOut();}
jQuery('.question-list ul').html(json.data);}},complete:function(){jQuery('.loading').fadeOut();}});});},translateControl:function(){jQuery('.lang').on('click',function(){var _this=jQuery(this),language=_this.data('lang');var selectField=document.querySelector("#google_translate_element select");jQuery('.lang').removeClass('active');_this.addClass('active');if(language=='vi'){jQuery('#\\:1\\.container').contents().find('#\\:1\\.restore').click();}else{for(var i=0;i<selectField.children.length;i++){var option=selectField.children[i];if(option.value==language){selectField.selectedIndex=i;selectField.dispatchEvent(new Event('change'));break;}}}});var input=jQuery('#searchform input');if(input.length){var div=jQuery('<div id="placeholders" style="display:none;"></div>');var text=input.attr('placeholder');div.append('<div>'+text+'</div>');jQuery('body').append(div);var originalPH=text;setInterval(function(){if(isTranslated()){updatePlaceholders();originalPH=text;}},200);function isTranslated(){var currentPH=jQuery(jQuery('#placeholders > div')[0]).text();return!(originalPH==currentPH);}
function updatePlaceholders(){jQuery('#placeholders > div').each(function(i,div){input.attr('placeholder',jQuery(div).text());});}}}};jQuery(document).ready(function(){App.owlCarousel();App.navbarMenu();App.filterProducts();App.popupAction();App.controlButton();App.buyWhere();App.filterMarkets();App.loadmoreProducts();App.compareProduct();App.questionAction();App.translateControl();});